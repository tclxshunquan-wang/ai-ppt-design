<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI PPTç”Ÿæˆå™¨ - äº§å“åŸå‹å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .prototype-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-button {
            padding: 10px 20px;
            border: none;
            background: #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background: #d0d0d0;
        }

        .tab-button.active {
            background: #4a90e2;
            color: white;
        }

        .page-content {
            display: none;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .page-content.active {
            display: block;
        }

        /* Headeræ ·å¼ */
        .header {
            height: 60px;
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-logo {
            font-size: 20px;
            font-weight: bold;
            color: #4a90e2;
        }

        .header-nav {
            display: flex;
            gap: 30px;
        }

        .nav-item {
            color: #666;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .nav-item:hover, .nav-item.active {
            color: #4a90e2;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4a90e2;
            color: white;
        }

        .btn-primary:hover {
            background: #357abd;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* é¦–é¡µæ ·å¼ */
        .hero-section {
            height: 66vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 40px;
        }

        .hero-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .hero-subtitle {
            font-size: 20px;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .hero-button {
            padding: 16px 40px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .hero-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .hero-chat-box {
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            margin-top: 30px;
        }

        .hero-chat-input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .hero-chat-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            resize: none;
            min-height: 56px;
            max-height: 120px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .hero-chat-input:focus {
            outline: none;
            border-color: #4a90e2;
        }

        .hero-chat-input::placeholder {
            color: #999;
        }

        .hero-chat-send {
            padding: 16px 32px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .hero-chat-send:hover {
            background: #357abd;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
        }

        .hero-chat-send:active {
            transform: translateY(0);
        }

        .hero-chat-hint {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 16px;
            text-align: center;
        }

        .hero-chat-shortcuts {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .hero-shortcut-tag {
            padding: 6px 14px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .hero-shortcut-tag:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .features-section {
            padding: 60px 40px;
        }

        .section-title {
            font-size: 32px;
            text-align: center;
            margin-bottom: 40px;
            color: #333;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .feature-card {
            background: #f9f9f9;
            padding: 24px;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            background: #4a90e2;
            border-radius: 50%;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
        }

        .feature-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .feature-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        .cases-section {
            padding: 60px 40px;
            background: #f9f9f9;
        }

        .cases-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            max-width: 1200px;
            margin: 0 auto 30px;
        }

        .case-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .case-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .case-thumbnail {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
        }

        .case-title {
            padding: 16px;
            font-size: 16px;
            font-weight: bold;
        }

        .more-button {
            text-align: center;
            margin-top: 30px;
        }

        .footer {
            padding: 40px;
            text-align: center;
            color: #999;
            background: #f9f9f9;
        }

        /* AIå·¥ä½œå°æ ·å¼ */
        .workspace-header {
            height: 60px;
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .mode-switch {
            display: flex;
            gap: 10px;
        }

        .mode-btn {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .mode-btn.active {
            background: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .workspace-container {
            display: flex;
            height: calc(100vh - 120px);
        }

        .chat-panel {
            width: 40%;
            background: #f9f9f9;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #4a90e2;
            color: white;
        }

        .message.ai .message-avatar {
            background: #e0e0e0;
            color: #666;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: #4a90e2;
            color: white;
        }

        .message.ai .message-content {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .suggestion-box {
            background: #f0f7ff;
            border: 1px solid #4a90e2;
            border-radius: 8px;
            padding: 16px;
            margin-top: 8px;
        }

        .suggestion-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #4a90e2;
        }

        .suggestion-content {
            font-size: 13px;
            color: #666;
            margin-bottom: 12px;
        }

        .confirm-btn {
            padding: 6px 16px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }

        .chat-input-area {
            padding: 16px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .shortcut-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .tag {
            padding: 6px 12px;
            background: #f0f0f0;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag:hover {
            background: #e0e0e0;
        }

        .input-wrapper {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }

        .send-btn {
            padding: 12px 24px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .preview-panel {
            width: 60%;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 20px 40px;
            overflow-y: auto;
        }

        .selection-hint {
            width: 100%;
            max-width: 900px;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #856404;
            display: none;
        }

        #workspace.edit-mode-active .selection-hint {
            display: block;
        }

        .ppt-canvas {
            width: 100%;
            max-width: 900px;
            aspect-ratio: 16/9;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .ppt-slide {
            width: 100%;
            height: 100%;
        }

        .ppt-title {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 24px;
            color: #333;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .ppt-title:hover {
            background: rgba(74, 144, 226, 0.1);
        }

        .ppt-image {
            display: inline-block;
            position: relative;
        }

        .ppt-image.selected-element {
            border: 2px solid #4a90e2 !important;
            background: rgba(74, 144, 226, 0.1) !important;
            padding: 4px;
            position: relative;
            box-sizing: border-box;
        }

        .ppt-image:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        .ppt-content {
            font-size: 18px;
            line-height: 1.8;
            color: #666;
        }

        .ppt-bullet {
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .ppt-bullet:hover {
            background: rgba(74, 144, 226, 0.1);
        }

        /* ç¼–è¾‘æ¨¡å¼ä¸‹çš„å¯ç‚¹å‡»å…ƒç´  */
        .edit-mode .ppt-title,
        .edit-mode .ppt-bullet,
        .edit-mode .ppt-image {
            position: relative;
            user-select: none;
        }

        /* ç¼–è¾‘æ¨¡å¼æç¤º */
        #workspace.edit-mode-active .selection-hint {
            display: block;
        }

        /* åœˆé€‰çŠ¶æ€ */
        .selected-element {
            border: 2px solid #4a90e2 !important;
            background: rgba(74, 144, 226, 0.1) !important;
            position: relative !important;
            padding: 8px;
            border-radius: 4px;
            box-sizing: border-box;
        }

        /* å›¾ç‰‡å…ƒç´ çš„é€‰ä¸­çŠ¶æ€ */
        .ppt-image.selected-element {
            border: 2px solid #4a90e2 !important;
            background: rgba(74, 144, 226, 0.1) !important;
            position: relative !important;
            padding: 4px;
            border-radius: 4px;
            box-sizing: border-box;
            display: inline-block !important;
        }

        /* æ“ä½œæ  */
        .selection-toolbar {
            position: absolute;
            top: -45px;
            right: 0;
            display: flex;
            gap: 6px;
            background: white;
            padding: 4px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.2);
            z-index: 10;
            animation: slideDown 0.2s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toolbar-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: #f5f5f5;
            font-size: 16px;
            transition: all 0.2s;
            border: 1px solid #e0e0e0;
        }

        .toolbar-icon:hover {
            background: #4a90e2;
            color: white;
            border-color: #4a90e2;
            transform: scale(1.1);
        }

        .toolbar-icon.add-to-chat {
            background: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .toolbar-icon.add-to-chat:hover {
            background: #357abd;
        }

        .toolbar-icon.delete {
            background: #ff4757;
            color: white;
            border-color: #ff4757;
        }

        .toolbar-icon.delete:hover {
            background: #ee3742;
        }

        .toolbar-icon.edit {
            background: #ffa502;
            color: white;
            border-color: #ffa502;
        }

        .toolbar-icon.edit:hover {
            background: #ff9500;
        }

        .toolbar-icon.move {
            background: #2ed573;
            color: white;
            border-color: #2ed573;
        }

        .toolbar-icon.move:hover {
            background: #26d467;
        }

        .toolbar-icon.move.active {
            background: #1e9e4f;
            cursor: move;
        }

        /* è°ƒæ•´ç‚¹ */
        .resize-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #4a90e2;
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .resize-handle:hover {
            background: #357abd;
            transform: scale(1.2);
        }

        /* è§’ç‚¹ */
        .resize-handle.nw {
            top: -6px;
            left: -6px;
            cursor: nw-resize;
        }

        .resize-handle.ne {
            top: -6px;
            right: -6px;
            cursor: ne-resize;
        }

        .resize-handle.sw {
            bottom: -6px;
            left: -6px;
            cursor: sw-resize;
        }

        .resize-handle.se {
            bottom: -6px;
            right: -6px;
            cursor: se-resize;
        }

        /* è¾¹ä¸­ç‚¹ */
        .resize-handle.n {
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            cursor: n-resize;
        }

        .resize-handle.s {
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            cursor: s-resize;
        }

        .resize-handle.w {
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
            cursor: w-resize;
        }

        .resize-handle.e {
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            cursor: e-resize;
        }

        /* æ‹–æ‹½çŠ¶æ€ */
        .selected-element.dragging {
            cursor: move;
            opacity: 0.8;
        }

        .selected-element.resizing {
            cursor: nw-resize;
        }

        /* å¤šé€‰çŠ¶æ€ */
        .multi-select-mode .ppt-title,
        .multi-select-mode .ppt-bullet {
            cursor: crosshair;
        }

        /* é€‰ä¸­è®¡æ•°æç¤º */
        .selection-count {
            position: absolute;
            top: -45px;
            left: 0;
            background: #4a90e2;
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: bold;
        }

        .property-panel {
            position: fixed;
            right: 0;
            top: 60px;
            width: 300px;
            height: calc(100vh - 60px);
            background: white;
            border-left: 1px solid #e0e0e0;
            padding: 24px;
            overflow-y: auto;
            box-shadow: -2px 0 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
        }

        .property-panel.collapsed {
            transform: translateX(100%);
        }

        .property-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e0e0e0;
        }

        .property-panel-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }

        .property-panel-toggle {
            width: 32px;
            height: 32px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 18px;
            color: #666;
        }

        .property-panel-toggle:hover {
            background: #f5f5f5;
            border-color: #4a90e2;
            color: #4a90e2;
        }

        .property-panel-content {
            transition: opacity 0.2s;
        }

        .property-panel.collapsed .property-panel-content {
            opacity: 0;
            pointer-events: none;
        }

        .content-editor {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .content-text-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
        }

        .content-text-input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.1);
        }

        .image-upload-area {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f9f9f9;
        }

        .image-upload-area:hover {
            border-color: #4a90e2;
            background: #f0f7ff;
        }

        .image-upload-area.has-image {
            border: none;
            padding: 0;
            background: transparent;
        }

        .image-upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
            color: #999;
        }

        .image-upload-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .image-upload-hint {
            font-size: 12px;
            color: #999;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 6px;
            margin-bottom: 12px;
        }

        .image-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .image-action-btn {
            padding: 6px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .image-action-btn:hover {
            background: #f5f5f5;
            border-color: #4a90e2;
            color: #4a90e2;
        }

        .image-action-btn.remove {
            color: #ff4757;
        }

        .image-action-btn.remove:hover {
            background: #fff5f5;
            border-color: #ff4757;
        }

        .ppt-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            object-fit: contain;
        }

        .ppt-image:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        .hidden-file-input {
            display: none;
        }

        /* æ”¶èµ·çŠ¶æ€ä¸‹çš„å±•å¼€æŒ‰é’® */
        .property-panel-expand-btn {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 80px;
            background: #4a90e2;
            border-radius: 8px 0 0 8px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: -2px 0 8px rgba(0,0,0,0.15);
            z-index: 999;
            transition: all 0.3s;
        }

        .property-panel.collapsed ~ .property-panel-expand-btn {
            display: flex;
        }


        .property-panel-expand-btn:hover {
            background: #357abd;
            width: 45px;
        }

        .property-panel-expand-btn::before {
            content: 'â—€';
            color: white;
            font-size: 20px;
        }

        .property-group {
            margin-bottom: 24px;
        }

        .property-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
        }

        .property-control {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .property-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .color-picker {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
        }

        .align-buttons {
            display: flex;
            gap: 4px;
        }

        .align-btn {
            width: 36px;
            height: 36px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: white;
        }

        .align-btn.active {
            background: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        /* ç´ æä¸­å¿ƒæ ·å¼ */
        .template-layout {
            display: flex;
            height: calc(100vh - 60px);
        }

        .template-sidebar {
            width: 200px;
            background: #f9f9f9;
            border-right: 1px solid #e0e0e0;
            padding: 24px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .category-list {
            list-style: none;
        }

        .category-item {
            padding: 12px;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 4px;
            transition: background 0.3s;
        }

        .category-item:hover {
            background: #e0e0e0;
        }

        .category-item.active {
            background: #4a90e2;
            color: white;
        }

        .template-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 24px;
        }

        .template-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .template-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .template-thumbnail {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
        }

        .template-info {
            padding: 16px;
        }

        .template-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .template-desc {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        /* å†å²é¡¹ç›®æ ·å¼ */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            padding: 40px;
        }

        .project-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .project-thumbnail {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
        }

        .project-info {
            padding: 20px;
        }

        .project-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .project-date {
            font-size: 13px;
            color: #999;
        }

        /* ä¸ªäººä¸­å¿ƒæ ·å¼ */
        .profile-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
        }

        .profile-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .profile-email {
            color: #999;
        }

        .profile-section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .section-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-label {
            color: #666;
        }

        .info-value {
            font-weight: bold;
        }

        .token-badge {
            display: inline-block;
            padding: 4px 12px;
            background: #4a90e2;
            color: white;
            border-radius: 12px;
            font-size: 14px;
        }
    </style>
    <script>
        // å…³é”®å‡½æ•°å¿…é¡»åœ¨HTMLå…ƒç´ ä¹‹å‰å®šä¹‰ï¼Œä»¥ä¾¿onclickå±æ€§å¯ä»¥è®¿é—®
        window.showPage = function(pageId, triggerElement) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeçŠ¶æ€
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„é¡µé¢
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // æ¿€æ´»å¯¹åº”çš„æ ‡ç­¾
            if (triggerElement) {
                triggerElement.classList.add('active');
            } else {
                // å¦‚æœæ²¡æœ‰ä¼ å…¥triggerElementï¼Œé€šè¿‡pageIdæ‰¾åˆ°å¯¹åº”çš„æŒ‰é’®
                const buttons = document.querySelectorAll('.tab-button');
                buttons.forEach(btn => {
                    const onclick = btn.getAttribute('onclick');
                    if (onclick && onclick.includes(`'${pageId}'`)) {
                        btn.classList.add('active');
                    }
                });
            }

            // å»¶è¿Ÿæ‰§è¡Œéœ€è¦å…¶ä»–å‡½æ•°çš„é€»è¾‘ï¼ˆåœ¨DOMContentLoadedä¹‹åï¼‰
            setTimeout(() => {
                // å¦‚æœè·³è½¬åˆ°AIå·¥ä½œå°ä¸”æœ‰pendingInputï¼Œè‡ªåŠ¨å¡«å……å¹¶å‘é€
                if (pageId === 'workspace' && window.pendingInput) {
                    setTimeout(() => {
                        const workspaceInput = document.querySelector('#workspace .chat-input');
                        if (workspaceInput) {
                            workspaceInput.value = window.pendingInput;
                            // è‡ªåŠ¨å‘é€æ¶ˆæ¯ï¼ˆå¦‚æœå‡½æ•°å·²å®šä¹‰ï¼‰
                            if (typeof window.sendWorkspaceMessage === 'function') {
                                window.sendWorkspaceMessage(window.pendingInput);
                            }
                            window.pendingInput = ''; // æ¸…ç©ºpendingInput
                        }
                    }, 200);
                }

                // åˆå§‹åŒ–åœˆé€‰åŠŸèƒ½
                if (pageId === 'workspace') {
                    // ç¡®ä¿åœ¨DOMå®Œå…¨åŠ è½½åå†åˆå§‹åŒ–
                    const initSelection = () => {
                        if (typeof window.initSelectionFeature === 'function') {
                            window.initSelectionFeature();
                        }
                    };
                    
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', function() {
                            setTimeout(initSelection, 100);
                        });
                    } else {
                        setTimeout(initSelection, 100);
                    }
                }
            }, 0);
        };

        window.goToWorkspace = function() {
            const heroInput = document.getElementById('heroChatInput');
            if (!heroInput) return;
            
            const inputValue = heroInput.value.trim();
            
            if (!inputValue) {
                alert('è¯·è¾“å…¥ä½ çš„PPTéœ€æ±‚');
                heroInput.focus();
                return;
            }

            // ä¿å­˜è¾“å…¥å†…å®¹åˆ°å…¨å±€å˜é‡
            window.pendingInput = inputValue;
            
            // åˆ‡æ¢åˆ°AIå·¥ä½œå°
            const workspaceTab = Array.from(document.querySelectorAll('.tab-button')).find(btn => 
                btn.getAttribute('onclick') && btn.getAttribute('onclick').includes('workspace')
            );
            if (workspaceTab) {
                window.showPage('workspace', workspaceTab);
            } else {
                window.showPage('workspace');
            }
        };

        window.fillQuickInput = function(type) {
            const heroInput = document.getElementById('heroChatInput');
            if (!heroInput) return;
            
            let placeholder = '';
            
            switch(type) {
                case 'ä¸€å¥è¯ç”Ÿæˆ':
                    placeholder = 'ç”Ÿæˆä¸€ä»½å…³äº AI å‘å±•å²çš„æ¼”è®² PPT';
                    break;
                case 'å¤§çº²ç”Ÿæˆ':
                    placeholder = 'ç²˜è´´ä½ çš„ PPT å¤§çº²...\n\nä¾‹å¦‚ï¼š\nç¬¬ä¸€éƒ¨åˆ†ï¼šAI çš„èµ·æº\n- 1950 å¹´ä»£çš„å¼€ç«¯\n- è¾¾ç‰¹èŒ…æ–¯ä¼šè®®\n\nç¬¬äºŒéƒ¨åˆ†ï¼šå‘å±•å†ç¨‹\n...';
                    break;
                case 'æè¿°ç”Ÿæˆ':
                    placeholder = 'ç²˜è´´ä½ çš„å®Œæ•´é¡µé¢æè¿°...\n\nä¾‹å¦‚ï¼š\nç¬¬ 1 é¡µ\næ ‡é¢˜ï¼šäººå·¥æ™ºèƒ½çš„è¯ç”Ÿ\nå†…å®¹ï¼š1950 å¹´ï¼Œå›¾çµæå‡º"å›¾çµæµ‹è¯•"...\n\nç¬¬ 2 é¡µ\næ ‡é¢˜ï¼šAI çš„å‘å±•å†ç¨‹\nå†…å®¹ï¼š1950å¹´ä»£ï¼šç¬¦å·ä¸»ä¹‰...\n...';
                    break;
            }
            
            heroInput.value = placeholder;
            heroInput.focus();
        };

        window.togglePropertyPanel = function() {
            const propertyPanel = document.getElementById('propertyPanel');
            const expandBtn = document.getElementById('propertyPanelExpandBtn');
            
            if (propertyPanel) {
                const isCollapsed = propertyPanel.classList.contains('collapsed');
                
                if (isCollapsed) {
                    // å±•å¼€é¢æ¿
                    propertyPanel.classList.remove('collapsed');
                    if (expandBtn) expandBtn.style.display = 'none';
                } else {
                    // æ”¶èµ·é¢æ¿
                    propertyPanel.classList.add('collapsed');
                    if (expandBtn) expandBtn.style.display = 'flex';
                }
                
                // ä¿å­˜çŠ¶æ€åˆ°localStorage
                localStorage.setItem('propertyPanelCollapsed', !isCollapsed);
            }
        };
    </script>
</head>
<body>
    <div class="prototype-container">
        <div class="page-tabs">
            <button class="tab-button active" onclick="showPage('home', this)">é¦–é¡µ</button>
            <button class="tab-button" onclick="showPage('workspace', this)">AIå·¥ä½œå°</button>
            <button class="tab-button" onclick="showPage('templates', this)">ç´ æä¸­å¿ƒ</button>
            <button class="tab-button" onclick="showPage('projects', this)">å†å²é¡¹ç›®</button>
            <button class="tab-button" onclick="showPage('profile', this)">ä¸ªäººä¸­å¿ƒ</button>
        </div>

        <!-- é¦–é¡µ -->
        <div id="home" class="page-content active">
            <div class="header">
                <div class="header-logo">AI PPTç”Ÿæˆå™¨</div>
                <div class="header-nav">
                    <a class="nav-item active">é¦–é¡µ</a>
                    <a class="nav-item">AIå·¥ä½œå°</a>
                    <a class="nav-item">ç´ æä¸­å¿ƒ</a>
                    <a class="nav-item">å†å²é¡¹ç›®</a>
                    <a class="nav-item">ä¸ªäººä¸­å¿ƒ</a>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary">å¼€å§‹ä½¿ç”¨</button>
                </div>
            </div>

            <div class="hero-section">
                <div class="hero-title">AI PPTç”Ÿæˆå™¨</div>
                <div class="hero-subtitle">ä¸€å¥è¯ç”Ÿæˆä¸“ä¸šPPTï¼Œè®©åˆ›ä½œå˜å¾—ç®€å•</div>
                <div class="hero-chat-box">
                    <div class="hero-chat-shortcuts">
                        <div class="hero-shortcut-tag" onclick="fillQuickInput('ä¸€å¥è¯ç”Ÿæˆ')">ä¸€å¥è¯ç”Ÿæˆ</div>
                        <div class="hero-shortcut-tag" onclick="fillQuickInput('å¤§çº²ç”Ÿæˆ')">å¤§çº²ç”Ÿæˆ</div>
                        <div class="hero-shortcut-tag" onclick="fillQuickInput('æè¿°ç”Ÿæˆ')">æè¿°ç”Ÿæˆ</div>
                    </div>
                    <div class="hero-chat-input-wrapper">
                        <textarea 
                            id="heroChatInput" 
                            class="hero-chat-input" 
                            placeholder="è¾“å…¥ä½ çš„PPTéœ€æ±‚ï¼Œä¾‹å¦‚ï¼šåšä¸€ä¸ªæˆ‘ä»¬æ–°äº§å“çš„ä»‹ç»PPT..."
                            rows="2"
                        ></textarea>
                        <button class="hero-chat-send" onclick="goToWorkspace()">ç”ŸæˆPPT</button>
                    </div>
                </div>
                <div class="hero-chat-hint">ğŸ’¡ æç¤ºï¼šè¾“å…¥ä¸€å¥è¯ã€å¤§çº²æˆ–è¯¦ç»†æè¿°ï¼ŒAIå°†è‡ªåŠ¨ä¸ºä½ ç”Ÿæˆä¸“ä¸šPPT</div>
            </div>

            <div class="features-section">
                <div class="section-title">æ ¸å¿ƒåŠŸèƒ½</div>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ’¬</div>
                        <div class="feature-title">ä¸€å¥è¯ç”Ÿæˆ</div>
                        <div class="feature-desc">è¾“å…¥ä¸€å¥è¯ï¼ŒAIè‡ªåŠ¨ç”Ÿæˆå®Œæ•´PPT</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ“</div>
                        <div class="feature-title">å¤§çº²ç”Ÿæˆ</div>
                        <div class="feature-desc">è¾“å…¥å¤§çº²ï¼ŒAIè‡ªåŠ¨åˆ†é¡µç”ŸæˆPPT</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ–¼ï¸</div>
                        <div class="feature-title">å›¾ç‰‡è¯†åˆ«</div>
                        <div class="feature-desc">ä¸Šä¼ å›¾ç‰‡ï¼ŒAIè¯†åˆ«å¹¶ç”ŸæˆPPT</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ¨</div>
                        <div class="feature-title">æ™ºèƒ½é…å›¾</div>
                        <div class="feature-desc">AIè‡ªåŠ¨ä¸ºæ¯é¡µç”Ÿæˆåˆé€‚é…å›¾</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">âœï¸</div>
                        <div class="feature-title">åœˆé€‰ç¼–è¾‘</div>
                        <div class="feature-desc">åœˆé€‰åŒºåŸŸï¼ŒAIç”Ÿæˆå†…å®¹å¡«å……</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ—£ï¸</div>
                        <div class="feature-title">å£å¤´ä¿®æ”¹</div>
                        <div class="feature-desc">ç”¨è‡ªç„¶è¯­è¨€ä¿®æ”¹PPTå†…å®¹</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ“Š</div>
                        <div class="feature-title">å®æ—¶é¢„è§ˆ</div>
                        <div class="feature-desc">ç”Ÿæˆè¿‡ç¨‹ä¸­å®æ—¶é¢„è§ˆæ•ˆæœ</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ’¾</div>
                        <div class="feature-title">å¤šæ ¼å¼å¯¼å‡º</div>
                        <div class="feature-desc">æ”¯æŒPDFã€PPTXæ ¼å¼å¯¼å‡º</div>
                    </div>
                </div>
            </div>

            <div class="cases-section">
                <div class="section-title">ä¼˜ç§€æ¡ˆä¾‹</div>
                <div class="cases-grid">
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸ“Š</div>
                        <div class="case-title">äº§å“ä»‹ç»PPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸ“</div>
                        <div class="case-title">æŠ€æœ¯åˆ†äº«PPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸ’¼</div>
                        <div class="case-title">å•†ä¸šææ¡ˆPPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸ“ˆ</div>
                        <div class="case-title">æ•°æ®åˆ†æPPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸš€</div>
                        <div class="case-title">é¡¹ç›®æ±‡æŠ¥PPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸ¯</div>
                        <div class="case-title">è¥é”€æ–¹æ¡ˆPPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸ“š</div>
                        <div class="case-title">è¯¾ç¨‹è®²è§£PPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸ’¡</div>
                        <div class="case-title">åˆ›æ„å±•ç¤ºPPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸ†</div>
                        <div class="case-title">è·å¥–ä½œå“PPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸŒŸ</div>
                        <div class="case-title">å¹´åº¦æ€»ç»“PPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸ¨</div>
                        <div class="case-title">è®¾è®¡ä½œå“PPT</div>
                    </div>
                    <div class="case-card">
                        <div class="case-thumbnail">ğŸ“±</div>
                        <div class="case-title">äº§å“å‘å¸ƒPPT</div>
                    </div>
                </div>
                <div class="more-button">
                    <button class="btn btn-secondary">æŸ¥çœ‹æ›´å¤šæ¡ˆä¾‹</button>
                </div>
            </div>

            <div class="footer">
                <p>Â© 2025 AI PPTç”Ÿæˆå™¨. All rights reserved.</p>
            </div>
        </div>

        <!-- AIå·¥ä½œå° -->
        <div id="workspace" class="page-content">
            <div class="workspace-header">
                <div class="mode-switch">
                    <button class="mode-btn active">ç¼–è¾‘æ¨¡å¼</button>
                    <button class="mode-btn">é¢„è§ˆæ¨¡å¼</button>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary">å¯¼å‡º PDF</button>
                    <button class="btn btn-primary">å¯¼å‡º PPTX</button>
                </div>
            </div>

            <div class="workspace-container">
                <div class="chat-panel">
                    <div class="chat-messages">
                        <div class="message ai">
                            <div class="message-avatar">AI</div>
                            <div>
                                <div class="message-content">ä½ å¥½ï¼æˆ‘å¯ä»¥å¸®ä½ ç”ŸæˆPPTã€‚ä½ å¯ä»¥ï¼š<br>1. è¾“å…¥ä¸€å¥è¯æè¿°<br>2. ç²˜è´´å¤§çº²å†…å®¹<br>3. ä¸Šä¼ å›¾ç‰‡<br>4. æè¿°å…·ä½“é¡µé¢å†…å®¹</div>
                            </div>
                        </div>
                        <div class="message user">
                            <div class="message-avatar">U</div>
                            <div>
                                <div class="message-content">åšä¸€ä¸ªæˆ‘ä»¬æ–°äº§å“çš„ä»‹ç»PPT</div>
                            </div>
                        </div>
                        <div class="message ai">
                            <div class="message-avatar">AI</div>
                            <div>
                                <div class="message-content">å¥½çš„ï¼Œæˆ‘ä¸ºä½ ç”Ÿæˆä¸€ä»½äº§å“ä»‹ç»PPTï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</div>
                                <div class="suggestion-box">
                                    <div class="suggestion-title">å»ºè®®çš„PPTç»“æ„ï¼š</div>
                                    <div class="suggestion-content">
                                        1. å°é¢é¡µ<br>
                                        2. äº§å“æ¦‚è¿°<br>
                                        3. æ ¸å¿ƒåŠŸèƒ½<br>
                                        4. æŠ€æœ¯ä¼˜åŠ¿<br>
                                        5. åº”ç”¨åœºæ™¯<br>
                                        6. å¸‚åœºåˆ†æ<br>
                                        7. ç«äº‰ä¼˜åŠ¿<br>
                                        8. å•†ä¸šæ¨¡å¼<br>
                                        9. å›¢é˜Ÿä»‹ç»<br>
                                        10. è”ç³»æ–¹å¼
                                    </div>
                                    <button class="confirm-btn">ç¡®è®¤ç”Ÿæˆ</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <div class="shortcut-tags">
                            <div class="tag">ä¸€å¥è¯ç”Ÿæˆ</div>
                            <div class="tag">å¤§çº²ç”Ÿæˆ</div>
                            <div class="tag">æè¿°ç”Ÿæˆ</div>
                        </div>
                        <div class="input-wrapper">
                            <textarea class="chat-input" placeholder="è¾“å…¥ä½ çš„éœ€æ±‚..."></textarea>
                            <button class="send-btn">å‘é€</button>
                        </div>
                    </div>
                </div>
                <div class="preview-panel">
                    <div class="selection-hint" id="selectionHint">
                        ğŸ’¡ <strong>åœˆé€‰ç¼–è¾‘æç¤ºï¼š</strong>åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹ï¼Œç‚¹å‡»PPTä¸­çš„å…ƒç´ è¿›è¡Œåœˆé€‰ã€‚æŒ‰ä½ Ctrl/Cmd é”®å¯å¤šé€‰ã€‚åœˆé€‰åç‚¹å‡»æ“ä½œæ çš„ ğŸ’¬ æŒ‰é’®å¯å°†å†…å®¹æ·»åŠ åˆ°Chatï¼Œç‚¹å‡» ğŸ—‘ï¸ æŒ‰é’®å¯åˆ é™¤å…ƒç´ ã€‚
                    </div>
                    <div class="ppt-canvas edit-mode" id="pptCanvas">
                        <div class="ppt-slide">
                            <div class="ppt-title" data-element="title" data-type="text" data-content="æ–°äº§å“ä»‹ç»">æ–°äº§å“ä»‹ç»</div>
                            <div class="ppt-content">
                                <div class="ppt-bullet" data-element="bullet" data-type="text" data-content="åˆ›æ–°äº§å“ï¼Œå¼•é¢†è¡Œä¸š">â€¢ åˆ›æ–°äº§å“ï¼Œå¼•é¢†è¡Œä¸š</div>
                                <div class="ppt-bullet" data-element="bullet" data-type="text" data-content="å¼ºå¤§åŠŸèƒ½ï¼Œå“è¶Šä½“éªŒ">â€¢ å¼ºå¤§åŠŸèƒ½ï¼Œå“è¶Šä½“éªŒ</div>
                                <div class="ppt-bullet" data-element="bullet" data-type="text" data-content="æ™ºèƒ½AIï¼ŒåŠ©åŠ›æˆé•¿">â€¢ æ™ºèƒ½AIï¼ŒåŠ©åŠ›æˆé•¿</div>
                                <!-- å›¾ç‰‡ç¤ºä¾‹ -->
                                <div style="margin-top: 24px; text-align: center;">
                                    <img src="empty.png" alt="ç¤ºä¾‹å›¾ç‰‡" class="ppt-image" data-element="image" data-type="image" data-content="empty.png" style="max-width: 400px; display: inline-block; position: relative;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å±æ€§é¢æ¿ï¼ˆç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤ºï¼‰ -->
            <div class="property-panel" id="propertyPanel">
                <div class="property-panel-header">
                    <div class="property-panel-title">å±æ€§è®¾ç½®</div>
                    <button class="property-panel-toggle" onclick="togglePropertyPanel()" title="æ”¶èµ·">âœ•</button>
                </div>
                <div class="property-panel-content">
                    <!-- å†…å®¹ç¼–è¾‘åŒºåŸŸ -->
                    <div class="content-editor" id="contentEditor">
                        <div class="property-label">å†…å®¹</div>
                        <!-- æ–‡æœ¬è¾“å…¥æ¡†ï¼ˆæ–‡æœ¬å…ƒç´ æ—¶æ˜¾ç¤ºï¼‰ -->
                        <textarea class="content-text-input" id="contentTextInput" placeholder="è¾“å…¥æ–‡æœ¬å†…å®¹..." style="display: none;"></textarea>
                        <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸï¼ˆå›¾ç‰‡å…ƒç´ æ—¶æ˜¾ç¤ºï¼‰ -->
                        <div class="image-upload-area" id="imageUploadArea" style="display: none;">
                            <div class="image-upload-icon">ğŸ“·</div>
                            <div class="image-upload-text">ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</div>
                            <div class="image-upload-hint">æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼</div>
                            <input type="file" id="imageFileInput" class="hidden-file-input" accept="image/*">
                        </div>
                    </div>
                    <!-- å›¾ç‰‡å°ºå¯¸è°ƒæ•´åŒºåŸŸï¼ˆä»…å›¾ç‰‡å…ƒç´ æ—¶æ˜¾ç¤ºï¼‰ -->
                    <div class="property-group" id="imageSizeGroup" style="display: none;">
                        <div class="property-label">å°ºå¯¸</div>
                        <div class="property-control" style="flex-direction: column; gap: 12px;">
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <label style="font-size: 12px; color: #666; width: 50px;">å®½åº¦:</label>
                                <input type="number" id="imageWidthInput" class="property-input" placeholder="å®½åº¦(px)" min="1">
                                <span style="font-size: 12px; color: #999;">px</span>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <label style="font-size: 12px; color: #666; width: 50px;">é«˜åº¦:</label>
                                <input type="number" id="imageHeightInput" class="property-input" placeholder="é«˜åº¦(px)" min="1">
                                <span style="font-size: 12px; color: #999;">px</span>
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <label style="font-size: 12px; color: #666; width: 50px;">æ¯”ä¾‹:</label>
                                <button id="lockAspectRatio" class="image-action-btn" style="width: auto; padding: 6px 12px;">ğŸ”’ é”å®š</button>
                            </div>
                        </div>
                    </div>
                    <div class="property-group">
                        <div class="property-label">å­—ä½“</div>
                        <div class="property-control">
                            <select class="property-input">
                                <option>å¾®è½¯é›…é»‘</option>
                                <option>å®‹ä½“</option>
                                <option>Arial</option>
                            </select>
                        </div>
                    </div>
                    <div class="property-group">
                        <div class="property-label">å­—å·</div>
                        <div class="property-control">
                            <input type="number" class="property-input" value="18">
                        </div>
                    </div>
                    <div class="property-group">
                        <div class="property-label">é¢œè‰²</div>
                        <div class="property-control">
                            <div class="color-picker" style="background: #333;"></div>
                        </div>
                    </div>
                    <div class="property-group">
                        <div class="property-label">å¯¹é½</div>
                        <div class="property-control">
                            <div class="align-buttons">
                                <div class="align-btn">å·¦</div>
                                <div class="align-btn active">ä¸­</div>
                                <div class="align-btn">å³</div>
                            </div>
                        </div>
                    </div>
                    <div class="property-group">
                        <div class="property-label">è¡Œè·</div>
                        <div class="property-control">
                            <input type="range" class="property-input" min="1" max="3" step="0.1" value="1.5">
                        </div>
                    </div>
                    <div class="property-group">
                        <div class="property-label">å­—é—´è·</div>
                        <div class="property-control">
                            <input type="range" class="property-input" min="0" max="10" step="1" value="0">
                        </div>
                    </div>
                </div>
            </div>
            <!-- å±•å¼€æŒ‰é’®ï¼ˆæ”¶èµ·æ—¶æ˜¾ç¤ºï¼‰ -->
            <div class="property-panel-expand-btn" id="propertyPanelExpandBtn" onclick="togglePropertyPanel()" title="å±•å¼€å±æ€§é¢æ¿"></div>
        </div>

        <!-- ç´ æä¸­å¿ƒ -->
        <div id="templates" class="page-content">
            <div class="header">
                <div class="header-logo">AI PPTç”Ÿæˆå™¨</div>
                <div class="header-nav">
                    <a class="nav-item">é¦–é¡µ</a>
                    <a class="nav-item">AIå·¥ä½œå°</a>
                    <a class="nav-item active">ç´ æä¸­å¿ƒ</a>
                    <a class="nav-item">å†å²é¡¹ç›®</a>
                    <a class="nav-item">ä¸ªäººä¸­å¿ƒ</a>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary">æˆ‘çš„æ¨¡æ¿</button>
                </div>
            </div>

            <div class="template-layout">
                <div class="template-sidebar">
                    <div class="sidebar-title">åˆ†ç±»</div>
                    <ul class="category-list">
                        <li class="category-item active">å…¨éƒ¨</li>
                        <li class="category-item">å•†åŠ¡</li>
                        <li class="category-item">æ•™è‚²</li>
                        <li class="category-item">ç§‘æŠ€</li>
                        <li class="category-item">è¥é”€</li>
                        <li class="category-item">æ±‡æŠ¥</li>
                        <li class="category-item">åˆ›æ„</li>
                    </ul>
                </div>
                <div class="template-content">
                    <div class="template-grid">
                        <div class="template-card">
                            <div class="template-thumbnail">ğŸ“Š</div>
                            <div class="template-info">
                                <div class="template-name">å•†åŠ¡æ±‡æŠ¥æ¨¡æ¿</div>
                                <div class="template-desc">é€‚åˆå•†åŠ¡æ±‡æŠ¥ã€é¡¹ç›®æ€»ç»“ç­‰åœºæ™¯</div>
                            </div>
                        </div>
                        <div class="template-card">
                            <div class="template-thumbnail">ğŸ“</div>
                            <div class="template-info">
                                <div class="template-name">æ•™è‚²è¯¾ä»¶æ¨¡æ¿</div>
                                <div class="template-desc">é€‚åˆæ•™å­¦è¯¾ä»¶ã€åŸ¹è®­ææ–™ç­‰åœºæ™¯</div>
                            </div>
                        </div>
                        <div class="template-card">
                            <div class="template-thumbnail">ğŸ’¼</div>
                            <div class="template-info">
                                <div class="template-name">å•†ä¸šææ¡ˆæ¨¡æ¿</div>
                                <div class="template-desc">é€‚åˆå•†ä¸šææ¡ˆã€æŠ•èµ„è·¯æ¼”ç­‰åœºæ™¯</div>
                            </div>
                        </div>
                        <div class="template-card">
                            <div class="template-thumbnail">ğŸš€</div>
                            <div class="template-info">
                                <div class="template-name">äº§å“å‘å¸ƒæ¨¡æ¿</div>
                                <div class="template-desc">é€‚åˆäº§å“å‘å¸ƒã€æ–°å“ä»‹ç»ç­‰åœºæ™¯</div>
                            </div>
                        </div>
                        <div class="template-card">
                            <div class="template-thumbnail">ğŸ“ˆ</div>
                            <div class="template-info">
                                <div class="template-name">æ•°æ®åˆ†ææ¨¡æ¿</div>
                                <div class="template-desc">é€‚åˆæ•°æ®åˆ†æã€æŠ¥å‘Šå±•ç¤ºç­‰åœºæ™¯</div>
                            </div>
                        </div>
                        <div class="template-card">
                            <div class="template-thumbnail">ğŸ¨</div>
                            <div class="template-info">
                                <div class="template-name">åˆ›æ„è®¾è®¡æ¨¡æ¿</div>
                                <div class="template-desc">é€‚åˆåˆ›æ„å±•ç¤ºã€è®¾è®¡ä½œå“ç­‰åœºæ™¯</div>
                            </div>
                        </div>
                        <div class="template-card">
                            <div class="template-thumbnail">ğŸ†</div>
                            <div class="template-info">
                                <div class="template-name">è·å¥–ä½œå“æ¨¡æ¿</div>
                                <div class="template-desc">é€‚åˆè·å¥–å±•ç¤ºã€æˆæœæ±‡æŠ¥ç­‰åœºæ™¯</div>
                            </div>
                        </div>
                        <div class="template-card">
                            <div class="template-thumbnail">ğŸŒŸ</div>
                            <div class="template-info">
                                <div class="template-name">å¹´åº¦æ€»ç»“æ¨¡æ¿</div>
                                <div class="template-desc">é€‚åˆå¹´åº¦æ€»ç»“ã€å·¥ä½œæ±‡æŠ¥ç­‰åœºæ™¯</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å†å²é¡¹ç›® -->
        <div id="projects" class="page-content">
            <div class="header">
                <div class="header-logo">AI PPTç”Ÿæˆå™¨</div>
                <div class="header-nav">
                    <a class="nav-item">é¦–é¡µ</a>
                    <a class="nav-item">AIå·¥ä½œå°</a>
                    <a class="nav-item">ç´ æä¸­å¿ƒ</a>
                    <a class="nav-item active">å†å²é¡¹ç›®</a>
                    <a class="nav-item">ä¸ªäººä¸­å¿ƒ</a>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary">æ–°å»ºé¡¹ç›®</button>
                </div>
            </div>

            <div class="projects-grid">
                <div class="project-card">
                    <div class="project-thumbnail">ğŸ“Š</div>
                    <div class="project-info">
                        <div class="project-title">äº§å“ä»‹ç»PPT</div>
                        <div class="project-date">2025-01-28 14:30</div>
                    </div>
                </div>
                <div class="project-card">
                    <div class="project-thumbnail">ğŸ“</div>
                    <div class="project-info">
                        <div class="project-title">æŠ€æœ¯åˆ†äº«PPT</div>
                        <div class="project-date">2025-01-27 10:15</div>
                    </div>
                </div>
                <div class="project-card">
                    <div class="project-thumbnail">ğŸ’¼</div>
                    <div class="project-info">
                        <div class="project-title">å•†ä¸šææ¡ˆPPT</div>
                        <div class="project-date">2025-01-26 16:45</div>
                    </div>
                </div>
                <div class="project-card">
                    <div class="project-thumbnail">ğŸ“ˆ</div>
                    <div class="project-info">
                        <div class="project-title">æ•°æ®åˆ†æPPT</div>
                        <div class="project-date">2025-01-25 09:20</div>
                    </div>
                </div>
                <div class="project-card">
                    <div class="project-thumbnail">ğŸš€</div>
                    <div class="project-info">
                        <div class="project-title">é¡¹ç›®æ±‡æŠ¥PPT</div>
                        <div class="project-date">2025-01-24 11:30</div>
                    </div>
                </div>
                <div class="project-card">
                    <div class="project-thumbnail">ğŸ¯</div>
                    <div class="project-info">
                        <div class="project-title">è¥é”€æ–¹æ¡ˆPPT</div>
                        <div class="project-date">2025-01-23 15:00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸ªäººä¸­å¿ƒ -->
        <div id="profile" class="page-content">
            <div class="header">
                <div class="header-logo">AI PPTç”Ÿæˆå™¨</div>
                <div class="header-nav">
                    <a class="nav-item">é¦–é¡µ</a>
                    <a class="nav-item">AIå·¥ä½œå°</a>
                    <a class="nav-item">ç´ æä¸­å¿ƒ</a>
                    <a class="nav-item">å†å²é¡¹ç›®</a>
                    <a class="nav-item active">ä¸ªäººä¸­å¿ƒ</a>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary">è®¾ç½®</button>
                </div>
            </div>

            <div class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar">U</div>
                    <div class="profile-name">ç”¨æˆ·å</div>
                    <div class="profile-email">user@example.com</div>
                </div>

                <div class="profile-section">
                    <div class="section-header">è´¦æˆ·ä¿¡æ¯</div>
                    <div class="info-item">
                        <span class="info-label">ç”¨æˆ·ID</span>
                        <span class="info-value">123456</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ³¨å†Œæ—¶é—´</span>
                        <span class="info-value">2025-01-01</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ä¼šå‘˜çŠ¶æ€</span>
                        <span class="info-value">æ™®é€šç”¨æˆ·</span>
                    </div>
                </div>

                <div class="profile-section">
                    <div class="section-header">Tokenä¿¡æ¯</div>
                    <div class="info-item">
                        <span class="info-label">å‰©ä½™Token</span>
                        <span class="info-value"><span class="token-badge">10,000</span></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å·²ä½¿ç”¨Token</span>
                        <span class="info-value">5,000</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ€»Token</span>
                        <span class="info-value">15,000</span>
                    </div>
                </div>

                <div class="profile-section">
                    <div class="section-header">ä½¿ç”¨ç»Ÿè®¡</div>
                    <div class="info-item">
                        <span class="info-label">åˆ›å»ºé¡¹ç›®æ•°</span>
                        <span class="info-value">25</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å¯¼å‡ºæ–‡ä»¶æ•°</span>
                        <span class="info-value">18</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ä½¿ç”¨æ¨¡æ¿æ•°</span>
                        <span class="info-value">12</span>
                    </div>
                </div>

                <div class="profile-section">
                    <div class="section-header">è®¢å•ç®¡ç†</div>
                    <div class="info-item">
                        <span class="info-label">å……å€¼è®¢å•</span>
                        <span class="info-value"><button class="btn btn-secondary">æŸ¥çœ‹è®¢å•</button></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">è´­ä¹°Token</span>
                        <span class="info-value"><button class="btn btn-primary">ç«‹å³å……å€¼</button></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å­˜å‚¨ä»é¦–é¡µä¼ é€’çš„å†…å®¹ï¼ˆå…¨å±€å˜é‡ï¼‰
        window.pendingInput = '';

        // åœ¨AIå·¥ä½œå°å‘é€æ¶ˆæ¯
        window.sendWorkspaceMessage = function(message) {
            const chatMessages = document.querySelector('#workspace .chat-messages');
            const workspaceInput = document.querySelector('#workspace .chat-input');
            
            if (!chatMessages || !workspaceInput) return;

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            const userMessage = document.createElement('div');
            userMessage.className = 'message user';
            userMessage.innerHTML = `
                <div class="message-avatar">U</div>
                <div>
                    <div class="message-content">${message}</div>
                </div>
            `;
            chatMessages.appendChild(userMessage);

            // æ¸…ç©ºè¾“å…¥æ¡†
            workspaceInput.value = '';

            // æ»šåŠ¨åˆ°åº•éƒ¨
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // æ¨¡æ‹ŸAIå›å¤
            setTimeout(() => {
                const aiMessage = document.createElement('div');
                aiMessage.className = 'message ai';
                aiMessage.innerHTML = `
                    <div class="message-avatar">AI</div>
                    <div>
                        <div class="message-content">å¥½çš„ï¼Œæˆ‘æ­£åœ¨ä¸ºä½ ç”ŸæˆPPT...</div>
                    </div>
                `;
                chatMessages.appendChild(aiMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // æ¨¡æ‹Ÿç”Ÿæˆè¿‡ç¨‹
                setTimeout(() => {
                    const suggestionBox = document.createElement('div');
                    suggestionBox.className = 'suggestion-box';
                    suggestionBox.innerHTML = `
                        <div class="suggestion-title">å»ºè®®çš„PPTç»“æ„ï¼š</div>
                        <div class="suggestion-content">
                            1. å°é¢é¡µ<br>
                            2. å†…å®¹æ¦‚è¿°<br>
                            3. è¯¦ç»†å†…å®¹<br>
                            4. æ€»ç»“é¡µ
                        </div>
                        <button class="confirm-btn" onclick="confirmGenerate()">ç¡®è®¤ç”Ÿæˆ</button>
                    `;
                    aiMessage.querySelector('div').appendChild(suggestionBox);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1000);
            }, 500);
        };

        // ç¡®è®¤ç”Ÿæˆ
        window.confirmGenerate = function() {
            const chatMessages = document.querySelector('#workspace .chat-messages');
            const aiMessage = chatMessages.querySelector('.message.ai:last-child');
            
            if (aiMessage) {
                aiMessage.querySelector('.suggestion-box').innerHTML = '<div class="suggestion-content">æ­£åœ¨ç”ŸæˆPPTï¼Œè¯·ç¨å€™...</div>';
                
                // æ¨¡æ‹Ÿç”ŸæˆPPT
                setTimeout(() => {
                    aiMessage.querySelector('.suggestion-box').innerHTML = '<div class="suggestion-content" style="color: #4a90e2;">âœ… PPTç”Ÿæˆå®Œæˆï¼</div>';
                    
                    // æ›´æ–°é¢„è§ˆåŒºåŸŸ
                    const pptCanvas = document.querySelector('#workspace .ppt-canvas');
                    if (pptCanvas) {
                        pptCanvas.innerHTML = `
                            <div class="ppt-slide">
                                <div class="ppt-title">ç”Ÿæˆçš„PPTæ ‡é¢˜</div>
                                <div class="ppt-content">
                                    <div class="ppt-bullet">â€¢ å†…å®¹è¦ç‚¹1</div>
                                    <div class="ppt-bullet">â€¢ å†…å®¹è¦ç‚¹2</div>
                                    <div class="ppt-bullet">â€¢ å†…å®¹è¦ç‚¹3</div>
                                </div>
                            </div>
                        `;
                    }
                }, 2000);
            }
        };

        // åœˆé€‰åŠŸèƒ½
        let selectedElements = new Set();
        let isMultiSelectMode = false;
        let isMoveMode = false;
        let isDragging = false;
        let dragStartX, dragStartY, dragStartLeft, dragStartTop;

        // åˆå§‹åŒ–åœˆé€‰åŠŸèƒ½
        window.initSelectionFeature = function() {
            const pptCanvas = document.getElementById('pptCanvas');
            if (!pptCanvas) {
                return;
            }

            // æ£€æŸ¥æ˜¯å¦åœ¨ç¼–è¾‘æ¨¡å¼
            const activeModeBtn = document.querySelector('#workspace .mode-btn.active');
            const isEditMode = activeModeBtn && activeModeBtn.textContent.trim() === 'ç¼–è¾‘æ¨¡å¼';
            
            if (!isEditMode) {
                if (typeof clearSelection === 'function') {
                    clearSelection();
                }
                return;
            }

            // æ¸…é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆé€šè¿‡å…‹éš†èŠ‚ç‚¹ï¼‰
            const newCanvas = pptCanvas.cloneNode(true);
            pptCanvas.parentNode.replaceChild(newCanvas, pptCanvas);

            // è·å–æ‰€æœ‰å¯é€‰æ‹©çš„å…ƒç´ ï¼ˆåŒ…æ‹¬æ–‡æœ¬å’Œå›¾ç‰‡ï¼‰
            const selectableElements = newCanvas.querySelectorAll('.ppt-title, .ppt-bullet, .ppt-image');
            
            // ç»‘å®šå…ƒç´ ç‚¹å‡»äº‹ä»¶ï¼ˆç›´æ¥ç»‘å®šåˆ°å…‹éš†åçš„å…ƒç´ ï¼‰
            selectableElements.forEach(element => {
                // ç¡®ä¿å…ƒç´ å¯ä»¥æ¥æ”¶ç‚¹å‡»äº‹ä»¶
                element.style.cursor = 'pointer';
                element.style.userSelect = 'none';
                element.style.pointerEvents = 'auto';
                
                // ç»‘å®šç‚¹å‡»äº‹ä»¶
                element.addEventListener('click', function(e) {
                    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°ç”»å¸ƒ
                    e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸º
                    
                    if (typeof handleElementClick === 'function') {
                        handleElementClick(this, e);
                    }
                });
            });

            // ç»‘å®šç”»å¸ƒçš„ç‚¹å‡»äº‹ä»¶ï¼ˆå¤„ç†ç©ºç™½å¤„ç‚¹å‡»ï¼‰
            newCanvas.addEventListener('click', function(e) {
                // æ£€æŸ¥ç‚¹å‡»çš„æ˜¯å¦æ˜¯å¯é€‰æ‹©çš„å…ƒç´ æˆ–å…¶å­å…ƒç´ 
                const clickedElement = e.target;
                const isSelectable = clickedElement.classList.contains('ppt-title') || 
                                    clickedElement.classList.contains('ppt-bullet') || 
                                    clickedElement.classList.contains('ppt-image') ||
                                    clickedElement.closest('.ppt-title') ||
                                    clickedElement.closest('.ppt-bullet') ||
                                    clickedElement.closest('.ppt-image') ||
                                    clickedElement.closest('.selected-element') ||
                                    clickedElement.closest('.selection-toolbar') ||
                                    clickedElement.closest('.resize-handle');
                
                // å¦‚æœç‚¹å‡»çš„æ˜¯å¯é€‰æ‹©çš„å…ƒç´ æˆ–ç›¸å…³UIï¼Œä¸å¤„ç†
                if (isSelectable) {
                    return;
                }
                
                // å¦‚æœç‚¹å‡»çš„æ˜¯ç”»å¸ƒç©ºç™½å¤„ï¼Œå–æ¶ˆé€‰æ‹©
                if (e.target === newCanvas || 
                    e.target.classList.contains('ppt-slide') || 
                    e.target.classList.contains('ppt-content')) {
                    if (typeof clearSelection === 'function') {
                        clearSelection();
                    }
                }
            });

            // æ›´æ–°å…¨å±€å¼•ç”¨
            window.pptCanvas = newCanvas;
        };

        // å¤„ç†å…ƒç´ ç‚¹å‡»
        function handleElementClick(element, e) {
            // æ³¨æ„ï¼šstopPropagation å·²ç»åœ¨å…ƒç´ çš„äº‹ä»¶ç›‘å¬å™¨ä¸­è°ƒç”¨äº†
            
            // å¦‚æœç‚¹å‡»çš„æ˜¯è°ƒæ•´ç‚¹æˆ–æ“ä½œæ ï¼Œä¸å¤„ç†
            if (e.target.classList.contains('resize-handle') || 
                e.target.classList.contains('toolbar-icon') ||
                e.target.closest('.selection-toolbar')) {
                return;
            }
            
            // å¦‚æœå¤„äºæ‹–æ‹½æ¨¡å¼ï¼Œä¸å¤„ç†ç‚¹å‡»ï¼ˆç”±æ‹–æ‹½äº‹ä»¶å¤„ç†ï¼‰
            if (isMoveMode && isDragging) {
                return;
            }
            
            e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯å›¾ç‰‡çš„æ‹–æ‹½

            // å¦‚æœæŒ‰ä½Ctrl/Cmdé”®ï¼Œè¿›å…¥å¤šé€‰æ¨¡å¼
            if (e.ctrlKey || e.metaKey) {
                isMultiSelectMode = true;
                toggleElementSelection(element);
            } else {
                // å•é€‰æ¨¡å¼
                if (!selectedElements.has(element)) {
                    clearSelection();
                    selectElement(element);
                    // å¦‚æœå±æ€§é¢æ¿å·²æ‰“å¼€ï¼Œæ›´æ–°åˆ°æ–°é€‰ä¸­çš„å…ƒç´ 
                    const propertyPanel = document.getElementById('propertyPanel');
                    if (propertyPanel && !propertyPanel.classList.contains('collapsed')) {
                        openPropertyPanel(element);
                    }
                } else {
                    // å¦‚æœç‚¹å‡»å·²é€‰ä¸­çš„å…ƒç´ ï¼Œå–æ¶ˆé€‰æ‹©ï¼ˆé™¤éå¤„äºæ‹–æ‹½æ¨¡å¼ï¼‰
                    if (!isMoveMode) {
                        deselectElement(element);
                    }
                }
            }

            updateSelectionToolbar();
        }

        // é€‰æ‹©å…ƒç´ 
        function selectElement(element) {
            if (selectedElements.has(element)) return;
            
            selectedElements.add(element);
            element.classList.add('selected-element');
            
            // ç¡®ä¿å›¾ç‰‡å…ƒç´ æœ‰æ­£ç¡®çš„å®šä½ä¸Šä¸‹æ–‡
            if (element.tagName === 'IMG') {
                // ç¡®ä¿å›¾ç‰‡å…ƒç´ æ˜¯inline-blockæˆ–blockï¼Œå¹¶ä¸”æœ‰relativeå®šä½
                element.style.position = 'relative';
                element.style.display = 'inline-block';
                element.style.boxSizing = 'border-box';
            }
            
            // åˆ›å»ºæ“ä½œæ 
            createToolbar(element);
            
            // åˆ›å»ºè°ƒæ•´ç‚¹ï¼ˆä»…å•é€‰æ—¶ï¼‰
            if (selectedElements.size === 1) {
                createResizeHandles(element);
            }
        }

        // å–æ¶ˆé€‰æ‹©å…ƒç´ 
        function deselectElement(element) {
            selectedElements.delete(element);
            element.classList.remove('selected-element');
            element.classList.remove('dragging');
            element.classList.remove('resizing');
            
            // ç§»é™¤æ“ä½œæ 
            const toolbar = element.querySelector('.selection-toolbar');
            if (toolbar) {
                toolbar.remove();
            }
            
            // ç§»é™¤è°ƒæ•´ç‚¹
            removeResizeHandles(element);
        }

        // åˆ‡æ¢å…ƒç´ é€‰æ‹©çŠ¶æ€
        function toggleElementSelection(element) {
            if (selectedElements.has(element)) {
                deselectElement(element);
            } else {
                selectElement(element);
            }
        }

        // æ¸…é™¤æ‰€æœ‰é€‰æ‹©
        function clearSelection() {
            const elementsToDeselect = Array.from(selectedElements);
            elementsToDeselect.forEach(element => {
                deselectElement(element);
            });
            selectedElements.clear();
            isMultiSelectMode = false;
            isMoveMode = false;
            isDragging = false;
        }

        // åˆ›å»ºæ“ä½œæ 
        function createToolbar(element) {
            // å¦‚æœå·²æœ‰æ“ä½œæ ï¼Œä¸é‡å¤åˆ›å»º
            if (element.querySelector('.selection-toolbar')) return;

            const toolbar = document.createElement('div');
            toolbar.className = 'selection-toolbar';
            
            // ç¼–è¾‘æŒ‰é’®ï¼ˆä»…å•é€‰æ—¶æ˜¾ç¤ºï¼‰
            // æ³¨æ„ï¼šæ­¤æ—¶selectedElements.sizeåº”è¯¥å·²ç»æ˜¯1äº†ï¼Œå› ä¸ºselectElementå…ˆaddå†è°ƒç”¨createToolbar
            if (selectedElements.size === 1) {
                const editBtn = document.createElement('div');
                editBtn.className = 'toolbar-icon edit';
                editBtn.innerHTML = 'âœï¸';
                editBtn.title = 'ç¼–è¾‘';
                editBtn.onclick = (e) => {
                    e.stopPropagation();
                    openPropertyPanel(element);
                };
                toolbar.appendChild(editBtn);

                // æ‹–æ‹½æŒ‰é’®ï¼ˆä»…å•é€‰æ—¶æ˜¾ç¤ºï¼‰
                const moveBtn = document.createElement('div');
                moveBtn.className = 'toolbar-icon move';
                moveBtn.innerHTML = 'â†”ï¸';
                moveBtn.title = 'æ‹–æ‹½ç§»åŠ¨';
                moveBtn.onclick = (e) => {
                    e.stopPropagation();
                    toggleMoveMode(element);
                };
                toolbar.appendChild(moveBtn);
            }
            
            // ç¡®ä¿æ“ä½œæ èƒ½æ­£ç¡®æ˜¾ç¤ºï¼ˆç‰¹åˆ«æ˜¯å›¾ç‰‡å…ƒç´ ï¼‰
            // å¯¹äºå›¾ç‰‡å…ƒç´ ï¼Œæ“ä½œæ åº”è¯¥æ˜¾ç¤ºåœ¨å›¾ç‰‡ä¸Šæ–¹
            if (element.tagName === 'IMG') {
                toolbar.style.top = '-50px'; // å›¾ç‰‡å…ƒç´ å¯èƒ½éœ€è¦æ›´å¤šç©ºé—´
            }

            // æ·»åŠ åˆ°ChatæŒ‰é’®
            const addToChatBtn = document.createElement('div');
            addToChatBtn.className = 'toolbar-icon add-to-chat';
            addToChatBtn.innerHTML = 'ğŸ’¬';
            addToChatBtn.title = 'æ·»åŠ åˆ°Chat';
            addToChatBtn.onclick = (e) => {
                e.stopPropagation();
                if (selectedElements.size > 1) {
                    // å¤šé€‰æ—¶ï¼Œæ·»åŠ æ‰€æœ‰é€‰ä¸­å†…å®¹
                    addMultipleToChat();
                } else {
                    addToChat(element);
                }
            };

            // åˆ é™¤æŒ‰é’®
            const deleteBtn = document.createElement('div');
            deleteBtn.className = 'toolbar-icon delete';
            deleteBtn.innerHTML = 'ğŸ—‘ï¸';
            deleteBtn.title = 'åˆ é™¤';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                if (selectedElements.size > 1) {
                    // å¤šé€‰æ—¶ï¼Œåˆ é™¤æ‰€æœ‰é€‰ä¸­å…ƒç´ 
                    deleteMultipleElements();
                } else {
                    deleteElement(element);
                }
            };

            toolbar.appendChild(addToChatBtn);
            toolbar.appendChild(deleteBtn);
            
            // å°†æ“ä½œæ æ·»åŠ åˆ°å…ƒç´ 
            element.appendChild(toolbar);
            
            // ç¡®ä¿æ“ä½œæ å¯è§ï¼ˆç¡®ä¿z-indexè¶³å¤Ÿé«˜ï¼‰
            toolbar.style.zIndex = '1000';
            
            // å¯¹äºå›¾ç‰‡å…ƒç´ ï¼Œç¡®ä¿æ“ä½œæ æ˜¾ç¤ºåœ¨å›¾ç‰‡ä¸Šæ–¹
            if (element.tagName === 'IMG') {
                // æ£€æŸ¥æ“ä½œæ æ˜¯å¦æˆåŠŸæ·»åŠ 
                const addedToolbar = element.querySelector('.selection-toolbar');
                if (!addedToolbar) {
                    console.warn('æ“ä½œæ æ·»åŠ å¤±è´¥ï¼Œå°è¯•é‡æ–°æ·»åŠ ');
                    // å¦‚æœæ·»åŠ å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨insertBefore
                    if (element.parentNode) {
                        element.parentNode.insertBefore(toolbar, element.nextSibling);
                        toolbar.style.position = 'absolute';
                        toolbar.style.top = '-50px';
                        toolbar.style.right = '0';
                    }
                }
            }
        }

        // åˆ›å»ºè°ƒæ•´ç‚¹
        function createResizeHandles(element) {
            // å¦‚æœå·²æœ‰è°ƒæ•´ç‚¹ï¼Œä¸é‡å¤åˆ›å»º
            if (element.querySelector('.resize-handle')) return;

            const handles = [
                { class: 'nw', cursor: 'nw-resize' }, // å·¦ä¸Š
                { class: 'n', cursor: 'n-resize' },   // ä¸Šä¸­
                { class: 'ne', cursor: 'ne-resize' }, // å³ä¸Š
                { class: 'e', cursor: 'e-resize' },   // å³ä¸­
                { class: 'se', cursor: 'se-resize' }, // å³ä¸‹
                { class: 's', cursor: 's-resize' },   // ä¸‹ä¸­
                { class: 'sw', cursor: 'sw-resize' }, // å·¦ä¸‹
                { class: 'w', cursor: 'w-resize' }    // å·¦ä¸­
            ];

            handles.forEach(handle => {
                const handleEl = document.createElement('div');
                handleEl.className = `resize-handle ${handle.class}`;
                handleEl.style.cursor = handle.cursor;
                handleEl.onmousedown = (e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    startResize(element, handle.class, e);
                };
                element.appendChild(handleEl);
            });
        }

        // ç§»é™¤è°ƒæ•´ç‚¹
        function removeResizeHandles(element) {
            const handles = element.querySelectorAll('.resize-handle');
            handles.forEach(handle => handle.remove());
        }

        // å¼€å§‹è°ƒæ•´å¤§å°
        let isResizing = false;
        let resizeHandle = null;
        let startX, startY, startWidth, startHeight, startLeft, startTop;

        function startResize(element, handleClass, e) {
            isResizing = true;
            resizeHandle = handleClass;
            element.classList.add('resizing');

            const rect = element.getBoundingClientRect();
            const canvas = element.closest('.ppt-canvas');
            const canvasRect = canvas ? canvas.getBoundingClientRect() : { left: 0, top: 0 };
            
            startX = e.clientX;
            startY = e.clientY;
            startWidth = rect.width;
            startHeight = rect.height;
            startLeft = rect.left - canvasRect.left;
            startTop = rect.top - canvasRect.top;

            document.addEventListener('mousemove', handleResize);
            document.addEventListener('mouseup', stopResize);
        }

        function handleResize(e) {
            if (!isResizing) return;

            const element = Array.from(selectedElements)[0];
            if (!element) return;

            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;

            let newWidth = startWidth;
            let newHeight = startHeight;
            let newLeft = startLeft;
            let newTop = startTop;

            // æ ¹æ®è°ƒæ•´ç‚¹ä½ç½®è®¡ç®—æ–°å°ºå¯¸å’Œä½ç½®
            switch(resizeHandle) {
                case 'nw': // å·¦ä¸Š
                    newWidth = startWidth - deltaX;
                    newHeight = startHeight - deltaY;
                    newLeft = startLeft + deltaX;
                    newTop = startTop + deltaY;
                    break;
                case 'n': // ä¸Š
                    newHeight = startHeight - deltaY;
                    newTop = startTop + deltaY;
                    break;
                case 'ne': // å³ä¸Š
                    newWidth = startWidth + deltaX;
                    newHeight = startHeight - deltaY;
                    newTop = startTop + deltaY;
                    break;
                case 'e': // å³
                    newWidth = startWidth + deltaX;
                    break;
                case 'se': // å³ä¸‹
                    newWidth = startWidth + deltaX;
                    newHeight = startHeight + deltaY;
                    break;
                case 's': // ä¸‹
                    newHeight = startHeight + deltaY;
                    break;
                case 'sw': // å·¦ä¸‹
                    newWidth = startWidth - deltaX;
                    newHeight = startHeight + deltaY;
                    newLeft = startLeft + deltaX;
                    break;
                case 'w': // å·¦
                    newWidth = startWidth - deltaX;
                    newLeft = startLeft + deltaX;
                    break;
            }

            // é™åˆ¶æœ€å°å°ºå¯¸
            const minSize = 20;
            if (newWidth < minSize) {
                newWidth = minSize;
                if (resizeHandle.includes('w')) {
                    newLeft = startLeft + startWidth - minSize;
                }
            }
            if (newHeight < minSize) {
                newHeight = minSize;
                if (resizeHandle.includes('n')) {
                    newTop = startTop + startHeight - minSize;
                }
            }

            // åº”ç”¨æ–°å°ºå¯¸å’Œä½ç½®
            element.style.width = newWidth + 'px';
            element.style.height = newHeight + 'px';
            
            // å¦‚æœå…ƒç´ æœ‰å®šä½ï¼Œæ›´æ–°ä½ç½®
            const computedStyle = window.getComputedStyle(element);
            if (computedStyle.position === 'absolute' || element.style.position === 'absolute') {
                element.style.position = 'absolute';
                element.style.left = newLeft + 'px';
                element.style.top = newTop + 'px';
            } else {
                // å¯¹äºéç»å¯¹å®šä½çš„å…ƒç´ ï¼Œè½¬æ¢ä¸ºç»å¯¹å®šä½
                const canvas = element.closest('.ppt-canvas');
                const canvasRect = canvas ? canvas.getBoundingClientRect() : { left: 0, top: 0 };
                const rect = element.getBoundingClientRect();
                element.style.position = 'absolute';
                element.style.left = (rect.left - canvasRect.left) + 'px';
                element.style.top = (rect.top - canvasRect.top) + 'px';
            }

            // æ›´æ–°å›¾ç‰‡å…ƒç´ çš„widthå’Œheightå±æ€§
            if (element.tagName === 'IMG') {
                element.width = newWidth;
                element.height = newHeight;
            }
        }

        function stopResize() {
            isResizing = false;
            resizeHandle = null;
            const element = Array.from(selectedElements)[0];
            if (element) {
                element.classList.remove('resizing');
            }
            document.removeEventListener('mousemove', handleResize);
            document.removeEventListener('mouseup', stopResize);
        }

        // æ‹–æ‹½ç§»åŠ¨æ¨¡å¼ï¼ˆå…¨å±€å˜é‡åœ¨æ–‡ä»¶é¡¶éƒ¨å·²å®šä¹‰ï¼‰
        function toggleMoveMode(element) {
            isMoveMode = !isMoveMode;
            const moveBtn = element.querySelector('.toolbar-icon.move');
            
            if (isMoveMode) {
                element.classList.add('dragging');
                element.style.cursor = 'move';
                if (moveBtn) moveBtn.classList.add('active');
                
                // ç¡®ä¿å…ƒç´ æœ‰å®šä½
                const computedStyle = window.getComputedStyle(element);
                if (computedStyle.position === 'static') {
                    const rect = element.getBoundingClientRect();
                    const canvas = element.closest('.ppt-canvas');
                    const canvasRect = canvas ? canvas.getBoundingClientRect() : { left: 0, top: 0 };
                    element.style.position = 'absolute';
                    element.style.left = (rect.left - canvasRect.left) + 'px';
                    element.style.top = (rect.top - canvasRect.top) + 'px';
                }
                
                // ç»‘å®šæ‹–æ‹½äº‹ä»¶
                element.onmousedown = (e) => {
                    if (e.target.classList.contains('resize-handle') || 
                        e.target.classList.contains('toolbar-icon') ||
                        e.target.closest('.selection-toolbar')) {
                        return;
                    }
                    startDrag(element, e);
                };
            } else {
                element.classList.remove('dragging');
                element.style.cursor = '';
                if (moveBtn) moveBtn.classList.remove('active');
                element.onmousedown = null;
                // å¦‚æœæ­£åœ¨æ‹–æ‹½ï¼Œåœæ­¢æ‹–æ‹½
                if (isDragging) {
                    stopDrag();
                }
            }
        }

        function startDrag(element, e) {
            isDragging = true;
            e.preventDefault();
            e.stopPropagation();

            const rect = element.getBoundingClientRect();
            const canvas = element.closest('.ppt-canvas');
            const canvasRect = canvas ? canvas.getBoundingClientRect() : { left: 0, top: 0 };
            
            dragStartX = e.clientX;
            dragStartY = e.clientY;
            dragStartLeft = rect.left - canvasRect.left;
            dragStartTop = rect.top - canvasRect.top;

            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', stopDrag);
        }

        function handleDrag(e) {
            if (!isDragging) return;

            const element = Array.from(selectedElements)[0];
            if (!element) return;

            const deltaX = e.clientX - dragStartX;
            const deltaY = e.clientY - dragStartY;

            const newLeft = dragStartLeft + deltaX;
            const newTop = dragStartTop + deltaY;

            // é™åˆ¶åœ¨ç”»å¸ƒèŒƒå›´å†…
            const canvas = element.closest('.ppt-canvas');
            if (canvas) {
                const canvasRect = canvas.getBoundingClientRect();
                const elementRect = element.getBoundingClientRect();
                const maxLeft = canvasRect.width - elementRect.width;
                const maxTop = canvasRect.height - elementRect.height;

                const clampedLeft = Math.max(0, Math.min(newLeft, maxLeft));
                const clampedTop = Math.max(0, Math.min(newTop, maxTop));

                element.style.left = clampedLeft + 'px';
                element.style.top = clampedTop + 'px';
            } else {
                element.style.left = newLeft + 'px';
                element.style.top = newTop + 'px';
            }
        }

        function stopDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', handleDrag);
            document.removeEventListener('mouseup', stopDrag);
        }

        // æ·»åŠ å¤šä¸ªé€‰ä¸­å…ƒç´ åˆ°Chat
        function addMultipleToChat() {
            const contents = Array.from(selectedElements).map(el => {
                const elementType = el.getAttribute('data-type') || 'text';
                if (elementType === 'image') {
                    const imgSrc = el.src || el.getAttribute('data-content') || '';
                    return `[å›¾ç‰‡] ${imgSrc}`;
                } else {
                    return el.getAttribute('data-content') || el.textContent.trim();
                }
            });
            
            const workspaceInput = document.querySelector('#workspace .chat-input');
            if (workspaceInput) {
                const currentValue = workspaceInput.value.trim();
                const newContent = '[åœˆé€‰å†…å®¹]\n' + contents.map((c, i) => `${i + 1}. ${c}`).join('\n');
                
                if (currentValue) {
                    workspaceInput.value = currentValue + '\n\n' + newContent;
                } else {
                    workspaceInput.value = newContent;
                }
                
                workspaceInput.focus();
                workspaceInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                workspaceInput.style.borderColor = '#4a90e2';
                workspaceInput.style.boxShadow = '0 0 0 3px rgba(74, 144, 226, 0.2)';
                setTimeout(() => {
                    workspaceInput.style.borderColor = '';
                    workspaceInput.style.boxShadow = '';
                }, 2000);
            }

            clearSelection();
        }

        // åˆ é™¤å¤šä¸ªé€‰ä¸­å…ƒç´ 
        function deleteMultipleElements() {
            if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedElements.size} ä¸ªå…ƒç´ å—ï¼Ÿ`)) {
                selectedElements.forEach(element => {
                    element.remove();
                });
                clearSelection();
            }
        }

        // æ›´æ–°é€‰æ‹©å·¥å…·æ ï¼ˆå¤šé€‰æ—¶æ˜¾ç¤ºè®¡æ•°ï¼‰
        function updateSelectionToolbar() {
            if (selectedElements.size > 1) {
                selectedElements.forEach(element => {
                    let toolbar = element.querySelector('.selection-toolbar');
                    if (toolbar) {
                        // å¤šé€‰æ—¶ç§»é™¤ç¼–è¾‘æŒ‰é’®å’Œæ‹–æ‹½æŒ‰é’®
                        const editBtn = toolbar.querySelector('.toolbar-icon.edit');
                        if (editBtn) {
                            editBtn.remove();
                        }
                        const moveBtn = toolbar.querySelector('.toolbar-icon.move');
                        if (moveBtn) {
                            moveBtn.remove();
                        }
                        
                        // ç§»é™¤è°ƒæ•´ç‚¹
                        removeResizeHandles(element);
                        
                        let countBadge = toolbar.querySelector('.selection-count');
                        if (!countBadge) {
                            countBadge = document.createElement('div');
                            countBadge.className = 'selection-count';
                            toolbar.insertBefore(countBadge, toolbar.firstChild);
                        }
                        countBadge.textContent = `å·²é€‰æ‹© ${selectedElements.size} é¡¹`;
                    }
                });
            } else {
                selectedElements.forEach(element => {
                    const toolbar = element.querySelector('.selection-toolbar');
                    if (toolbar) {
                        const countBadge = toolbar.querySelector('.selection-count');
                        if (countBadge) {
                            countBadge.remove();
                        }
                        
                        // å•é€‰æ—¶æ·»åŠ ç¼–è¾‘æŒ‰é’®ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
                        if (!toolbar.querySelector('.toolbar-icon.edit')) {
                            const editBtn = document.createElement('div');
                            editBtn.className = 'toolbar-icon edit';
                            editBtn.innerHTML = 'âœï¸';
                            editBtn.title = 'ç¼–è¾‘';
                            editBtn.onclick = (e) => {
                                e.stopPropagation();
                                openPropertyPanel(element);
                            };
                            toolbar.insertBefore(editBtn, toolbar.firstChild);
                        }
                        
                        // å•é€‰æ—¶æ·»åŠ æ‹–æ‹½æŒ‰é’®ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
                        if (!toolbar.querySelector('.toolbar-icon.move')) {
                            const moveBtn = document.createElement('div');
                            moveBtn.className = 'toolbar-icon move';
                            moveBtn.innerHTML = 'â†”ï¸';
                            moveBtn.title = 'æ‹–æ‹½ç§»åŠ¨';
                            moveBtn.onclick = (e) => {
                                e.stopPropagation();
                                toggleMoveMode(element);
                            };
                            const editBtn = toolbar.querySelector('.toolbar-icon.edit');
                            if (editBtn) {
                                editBtn.after(moveBtn);
                            } else {
                                toolbar.insertBefore(moveBtn, toolbar.firstChild);
                            }
                        }
                        
                        // åˆ›å»ºè°ƒæ•´ç‚¹ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
                        if (!element.querySelector('.resize-handle')) {
                            createResizeHandles(element);
                        }
                        
                        // å¦‚æœå±æ€§é¢æ¿å·²æ‰“å¼€ï¼Œæ›´æ–°åˆ°å½“å‰é€‰ä¸­çš„å…ƒç´ 
                        const propertyPanel = document.getElementById('propertyPanel');
                        if (propertyPanel && !propertyPanel.classList.contains('collapsed')) {
                            openPropertyPanel(element);
                        }
                    }
                });
            }
        }

        // æ‰“å¼€å±æ€§é¢æ¿å¹¶ç»‘å®šé€‰ä¸­å…ƒç´ 
        function openPropertyPanel(element) {
            const propertyPanel = document.getElementById('propertyPanel');
            const expandBtn = document.getElementById('propertyPanelExpandBtn');
            
            if (!propertyPanel) return;
            
            // ç¡®ä¿å±æ€§é¢æ¿å±•å¼€
            propertyPanel.classList.remove('collapsed');
            if (expandBtn) expandBtn.style.display = 'none';
            
            // ä¿å­˜å½“å‰ç¼–è¾‘çš„å…ƒç´ 
            window.currentEditingElement = element;
            
            // åŠ è½½å…ƒç´ çš„å½“å‰å±æ€§åˆ°å±æ€§é¢æ¿
            loadElementProperties(element);
            
            // ç»‘å®šå±æ€§å˜åŒ–äº‹ä»¶
            bindPropertyEvents(element);
        }

        // åŠ è½½å…ƒç´ å±æ€§åˆ°å±æ€§é¢æ¿
        function loadElementProperties(element) {
            const propertyPanel = document.getElementById('propertyPanel');
            if (!propertyPanel) return;
            
            // è·å–å…ƒç´ ç±»å‹
            const elementType = element.getAttribute('data-type') || 'text';
            const contentTextInput = document.getElementById('contentTextInput');
            const imageUploadArea = document.getElementById('imageUploadArea');
            const imageFileInput = document.getElementById('imageFileInput');
            
            // æ ¹æ®å…ƒç´ ç±»å‹æ˜¾ç¤ºä¸åŒçš„å†…å®¹ç¼–è¾‘å™¨
            if (elementType === 'image') {
                // å›¾ç‰‡å…ƒç´ ï¼šæ˜¾ç¤ºå›¾ç‰‡ä¸Šä¼ åŒºåŸŸ
                if (contentTextInput) contentTextInput.style.display = 'none';
                if (imageUploadArea) {
                    imageUploadArea.style.display = 'block';
                    
                    // å¦‚æœå·²æœ‰å›¾ç‰‡ï¼Œæ˜¾ç¤ºé¢„è§ˆ
                    const imgSrc = element.src || element.getAttribute('data-content');
                    if (imgSrc && imgSrc !== 'empty.png') {
                        showImagePreview(imgSrc);
                    } else {
                        showImageUploadPlaceholder();
                    }
                }
                
                // æ˜¾ç¤ºå›¾ç‰‡å°ºå¯¸è°ƒæ•´åŒºåŸŸ
                const imageSizeGroup = document.getElementById('imageSizeGroup');
                if (imageSizeGroup) {
                    imageSizeGroup.style.display = 'block';
                    
                    // åŠ è½½å½“å‰å›¾ç‰‡å°ºå¯¸
                    const currentWidth = element.style.width || element.width || '';
                    const currentHeight = element.style.height || element.height || '';
                    
                    const widthInput = document.getElementById('imageWidthInput');
                    const heightInput = document.getElementById('imageHeightInput');
                    
                    if (widthInput) {
                        const width = currentWidth ? parseInt(currentWidth) : (element.naturalWidth || 400);
                        widthInput.value = width;
                    }
                    
                    if (heightInput) {
                        const height = currentHeight ? parseInt(currentHeight) : (element.naturalHeight || 300);
                        heightInput.value = height;
                    }
                }
                
                // éšè—æ–‡æœ¬ç›¸å…³çš„å±æ€§ï¼ˆå­—ä½“ã€å­—å·ã€é¢œè‰²ã€å¯¹é½ã€è¡Œè·ã€å­—é—´è·ï¼‰
                const textProperties = propertyPanel.querySelectorAll('.property-group');
                textProperties.forEach((group) => {
                    // è·³è¿‡å†…å®¹ç¼–è¾‘åŒºåŸŸå’Œå›¾ç‰‡å°ºå¯¸åŒºåŸŸ
                    if (group.id !== 'imageSizeGroup' && group.id !== 'contentEditor') {
                        group.style.display = 'none';
                    }
                });
            } else {
                // æ–‡æœ¬å…ƒç´ ï¼šæ˜¾ç¤ºæ–‡æœ¬è¾“å…¥æ¡†
                if (imageUploadArea) imageUploadArea.style.display = 'none';
                if (contentTextInput) {
                    contentTextInput.style.display = 'block';
                    // åŠ è½½æ–‡æœ¬å†…å®¹
                    const textContent = element.textContent.trim() || element.getAttribute('data-content') || '';
                    // ç§»é™¤é¡¹ç›®ç¬¦å·
                    contentTextInput.value = textContent.replace(/^[â€¢Â·\-\*]\s*/, '');
                }
                
                // éšè—å›¾ç‰‡å°ºå¯¸è°ƒæ•´åŒºåŸŸ
                const imageSizeGroup = document.getElementById('imageSizeGroup');
                if (imageSizeGroup) {
                    imageSizeGroup.style.display = 'none';
                }
                
                // æ˜¾ç¤ºæ–‡æœ¬ç›¸å…³çš„å±æ€§
                const textProperties = propertyPanel.querySelectorAll('.property-group');
                textProperties.forEach((group) => {
                    // è·³è¿‡å†…å®¹ç¼–è¾‘åŒºåŸŸå’Œå›¾ç‰‡å°ºå¯¸åŒºåŸŸ
                    if (group.id !== 'imageSizeGroup' && group.id !== 'contentEditor') {
                        group.style.display = 'block';
                    }
                });
                
                // è·å–å…ƒç´ çš„æ ·å¼
                const computedStyle = window.getComputedStyle(element);
                
                // è®¾ç½®å­—ä½“
                const fontSelect = propertyPanel.querySelector('.property-group select');
                if (fontSelect) {
                    const fontFamily = computedStyle.fontFamily || 'å¾®è½¯é›…é»‘';
                    fontSelect.value = fontFamily.includes('å¾®è½¯é›…é»‘') ? 'å¾®è½¯é›…é»‘' : 
                                     fontFamily.includes('å®‹ä½“') ? 'å®‹ä½“' : 
                                     fontFamily.includes('Arial') ? 'Arial' : 'å¾®è½¯é›…é»‘';
                }
                
                // è®¾ç½®å­—å·
                const fontSizeInput = propertyPanel.querySelector('.property-group input[type="number"]');
                if (fontSizeInput) {
                    const fontSize = parseInt(computedStyle.fontSize);
                    fontSizeInput.value = fontSize || 18;
                }
                
                // è®¾ç½®é¢œè‰²
                const colorPicker = propertyPanel.querySelector('.color-picker');
                if (colorPicker) {
                    const color = computedStyle.color || '#333';
                    colorPicker.style.background = color;
                }
                
                // è®¾ç½®å¯¹é½ï¼ˆæ ¹æ®textAlignï¼‰
                const alignButtons = propertyPanel.querySelectorAll('.align-btn');
                if (alignButtons.length > 0) {
                    alignButtons.forEach(btn => btn.classList.remove('active'));
                    const textAlign = computedStyle.textAlign || 'center';
                    if (textAlign === 'left') alignButtons[0].classList.add('active');
                    else if (textAlign === 'center') alignButtons[1].classList.add('active');
                    else if (textAlign === 'right') alignButtons[2].classList.add('active');
                }
                
                // è®¾ç½®è¡Œè·
                const lineHeightInput = propertyPanel.querySelectorAll('.property-group input[type="range"]')[0];
                if (lineHeightInput) {
                    const lineHeight = parseFloat(computedStyle.lineHeight) || 1.5;
                    lineHeightInput.value = lineHeight;
                }
                
                // è®¾ç½®å­—é—´è·
                const letterSpacingInput = propertyPanel.querySelectorAll('.property-group input[type="range"]')[1];
                if (letterSpacingInput) {
                    const letterSpacing = parseInt(computedStyle.letterSpacing) || 0;
                    letterSpacingInput.value = letterSpacing;
                }
            }
        }

        // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
        function showImagePreview(imgSrc) {
            const imageUploadArea = document.getElementById('imageUploadArea');
            if (!imageUploadArea) return;
            
            imageUploadArea.classList.add('has-image');
            imageUploadArea.innerHTML = `
                <img src="${imgSrc}" alt="é¢„è§ˆå›¾ç‰‡" class="image-preview" id="imagePreview">
                <div class="image-actions">
                    <button class="image-action-btn" onclick="triggerImageUpload()">æ›´æ¢å›¾ç‰‡</button>
                    <button class="image-action-btn remove" onclick="removeImage()">åˆ é™¤å›¾ç‰‡</button>
                </div>
            `;
        }

        // æ˜¾ç¤ºå›¾ç‰‡ä¸Šä¼ å ä½ç¬¦
        function showImageUploadPlaceholder() {
            const imageUploadArea = document.getElementById('imageUploadArea');
            if (!imageUploadArea) return;
            
            imageUploadArea.classList.remove('has-image');
            imageUploadArea.innerHTML = `
                <div class="image-upload-icon">ğŸ“·</div>
                <div class="image-upload-text">ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</div>
                <div class="image-upload-hint">æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼</div>
                <input type="file" id="imageFileInput" class="hidden-file-input" accept="image/*">
            `;
            
            // é‡æ–°ç»‘å®šç‚¹å‡»äº‹ä»¶
            imageUploadArea.onclick = () => {
                const fileInput = document.getElementById('imageFileInput');
                if (fileInput) fileInput.click();
            };
            
            // ç»‘å®šæ–‡ä»¶é€‰æ‹©äº‹ä»¶
            const fileInput = document.getElementById('imageFileInput');
            if (fileInput) {
                fileInput.onchange = handleImageUpload;
            }
        }

        // è§¦å‘å›¾ç‰‡ä¸Šä¼ 
        function triggerImageUpload() {
            const fileInput = document.getElementById('imageFileInput');
            if (fileInput) {
                fileInput.click();
            }
        }

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('image/')) {
                alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                return;
            }
            
            // åˆ›å»ºFileReaderè¯»å–å›¾ç‰‡
            const reader = new FileReader();
            reader.onload = function(e) {
                const imgSrc = e.target.result;
                const currentElement = window.currentEditingElement;
                
                if (currentElement && currentElement.tagName === 'IMG') {
                    // åˆ›å»ºä¸´æ—¶å›¾ç‰‡å¯¹è±¡è·å–åŸå§‹å°ºå¯¸
                    const tempImg = new Image();
                    tempImg.onload = function() {
                        // æ›´æ–°å›¾ç‰‡å…ƒç´ 
                        currentElement.src = imgSrc;
                        currentElement.setAttribute('data-content', imgSrc);
                        
                        // å¦‚æœå›¾ç‰‡æ²¡æœ‰è®¾ç½®å°ºå¯¸ï¼Œä½¿ç”¨åŸå§‹å°ºå¯¸
                        if (!currentElement.style.width && !currentElement.width) {
                            currentElement.style.width = tempImg.width + 'px';
                            currentElement.style.height = tempImg.height + 'px';
                            currentElement.width = tempImg.width;
                            currentElement.height = tempImg.height;
                            
                            // æ›´æ–°å±æ€§é¢æ¿ä¸­çš„å°ºå¯¸è¾“å…¥æ¡†
                            const widthInput = document.getElementById('imageWidthInput');
                            const heightInput = document.getElementById('imageHeightInput');
                            if (widthInput) widthInput.value = tempImg.width;
                            if (heightInput) heightInput.value = tempImg.height;
                        }
                        
                        // æ›´æ–°é¢„è§ˆ
                        showImagePreview(imgSrc);
                    };
                    tempImg.src = imgSrc;
                }
            };
            reader.readAsDataURL(file);
        }

        // åˆ é™¤å›¾ç‰‡
        function removeImage() {
            const currentElement = window.currentEditingElement;
            if (currentElement && currentElement.tagName === 'IMG') {
                // æ¢å¤é»˜è®¤å›¾ç‰‡
                currentElement.src = 'empty.png';
                currentElement.setAttribute('data-content', 'empty.png');
                
                // æ›´æ–°é¢„è§ˆ
                showImageUploadPlaceholder();
            }
        }

        // ç»‘å®šå±æ€§å˜åŒ–äº‹ä»¶
        function bindPropertyEvents(element) {
            const propertyPanel = document.getElementById('propertyPanel');
            if (!propertyPanel) return;
            
            const elementType = element.getAttribute('data-type') || 'text';
            
            // å†…å®¹ç¼–è¾‘äº‹ä»¶
            if (elementType === 'text') {
                // æ–‡æœ¬å†…å®¹å˜åŒ–
                const contentTextInput = document.getElementById('contentTextInput');
                if (contentTextInput) {
                    contentTextInput.oninput = () => {
                        const newText = contentTextInput.value;
                        // å¦‚æœæ˜¯è¦ç‚¹ï¼Œä¿ç•™é¡¹ç›®ç¬¦å·
                        if (element.classList.contains('ppt-bullet')) {
                            element.textContent = 'â€¢ ' + newText;
                        } else {
                            element.textContent = newText;
                        }
                        element.setAttribute('data-content', newText);
                    };
                }
            } else if (elementType === 'image') {
                // å›¾ç‰‡ä¸Šä¼ äº‹ä»¶å·²åœ¨showImageUploadPlaceholderä¸­ç»‘å®š
                const imageUploadArea = document.getElementById('imageUploadArea');
                if (imageUploadArea && !imageUploadArea.classList.contains('has-image')) {
                    imageUploadArea.onclick = () => {
                        const fileInput = document.getElementById('imageFileInput');
                        if (fileInput) fileInput.click();
                    };
                    
                    const fileInput = document.getElementById('imageFileInput');
                    if (fileInput) {
                        fileInput.onchange = handleImageUpload;
                    }
                }
                
                // å›¾ç‰‡å°ºå¯¸è°ƒæ•´äº‹ä»¶
                const widthInput = document.getElementById('imageWidthInput');
                const heightInput = document.getElementById('imageHeightInput');
                const lockAspectRatioBtn = document.getElementById('lockAspectRatio');
                
                let isAspectRatioLocked = true;
                let aspectRatio = 1;
                
                // è®¡ç®—åˆå§‹å®½é«˜æ¯”
                if (element.naturalWidth && element.naturalHeight) {
                    aspectRatio = element.naturalWidth / element.naturalHeight;
                } else if (element.width && element.height) {
                    aspectRatio = element.width / element.height;
                }
                
                // é”å®š/è§£é”å®½é«˜æ¯”
                if (lockAspectRatioBtn) {
                    lockAspectRatioBtn.onclick = () => {
                        isAspectRatioLocked = !isAspectRatioLocked;
                        lockAspectRatioBtn.textContent = isAspectRatioLocked ? 'ğŸ”’ é”å®š' : 'ğŸ”“ è§£é”';
                        lockAspectRatioBtn.style.color = isAspectRatioLocked ? '' : '#4a90e2';
                    };
                }
                
                // å®½åº¦å˜åŒ–
                if (widthInput) {
                    widthInput.oninput = () => {
                        const width = parseInt(widthInput.value) || 0;
                        if (width > 0) {
                            element.style.width = width + 'px';
                            element.width = width;
                            
                            // å¦‚æœé”å®šå®½é«˜æ¯”ï¼Œè‡ªåŠ¨è°ƒæ•´é«˜åº¦
                            if (isAspectRatioLocked && aspectRatio > 0 && heightInput) {
                                const newHeight = Math.round(width / aspectRatio);
                                heightInput.value = newHeight;
                                element.style.height = newHeight + 'px';
                                element.height = newHeight;
                            }
                        }
                    };
                }
                
                // é«˜åº¦å˜åŒ–
                if (heightInput) {
                    heightInput.oninput = () => {
                        const height = parseInt(heightInput.value) || 0;
                        if (height > 0) {
                            element.style.height = height + 'px';
                            element.height = height;
                            
                            // å¦‚æœé”å®šå®½é«˜æ¯”ï¼Œè‡ªåŠ¨è°ƒæ•´å®½åº¦
                            if (isAspectRatioLocked && aspectRatio > 0 && widthInput) {
                                const newWidth = Math.round(height * aspectRatio);
                                widthInput.value = newWidth;
                                element.style.width = newWidth + 'px';
                                element.width = newWidth;
                            }
                        }
                    };
                }
            }
            
            // æ–‡æœ¬æ ·å¼å±æ€§ï¼ˆä»…æ–‡æœ¬å…ƒç´ ï¼‰
            if (elementType === 'text') {
                // å­—ä½“å˜åŒ–
                const fontSelect = propertyPanel.querySelector('.property-group select');
                if (fontSelect) {
                    fontSelect.onchange = () => {
                        element.style.fontFamily = fontSelect.value;
                    };
                }
                
                // å­—å·å˜åŒ–
                const fontSizeInput = propertyPanel.querySelector('.property-group input[type="number"]');
                if (fontSizeInput) {
                    fontSizeInput.oninput = () => {
                        element.style.fontSize = fontSizeInput.value + 'px';
                    };
                }
                
                // é¢œè‰²å˜åŒ–
                const colorPicker = propertyPanel.querySelector('.color-picker');
                if (colorPicker) {
                    colorPicker.onclick = () => {
                        // ç®€å•çš„é¢œè‰²é€‰æ‹©ï¼ˆå®é™…å¯ä»¥ä½¿ç”¨é¢œè‰²é€‰æ‹©å™¨ç»„ä»¶ï¼‰
                        const colors = ['#333', '#4a90e2', '#ff4757', '#ffa502', '#2ed573', '#5f27cd'];
                        const currentColor = colorPicker.style.background || '#333';
                        let currentIndex = -1;
                        for (let i = 0; i < colors.length; i++) {
                            if (colors[i] === currentColor || currentColor.includes(colors[i].substring(1))) {
                                currentIndex = i;
                                break;
                            }
                        }
                        const nextIndex = (currentIndex + 1) % colors.length;
                        colorPicker.style.background = colors[nextIndex];
                        element.style.color = colors[nextIndex];
                    };
                }
                
                // å¯¹é½å˜åŒ–
                const alignButtons = propertyPanel.querySelectorAll('.align-btn');
                alignButtons.forEach((btn, index) => {
                    // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨
                    const newBtn = btn.cloneNode(true);
                    btn.parentNode.replaceChild(newBtn, btn);
                    
                    newBtn.onclick = () => {
                        alignButtons.forEach(b => b.classList.remove('active'));
                        newBtn.classList.add('active');
                        const aligns = ['left', 'center', 'right'];
                        element.style.textAlign = aligns[index];
                    };
                });
                
                // è¡Œè·å˜åŒ–
                const lineHeightInputs = propertyPanel.querySelectorAll('.property-group input[type="range"]');
                if (lineHeightInputs.length > 0) {
                    lineHeightInputs[0].oninput = () => {
                        element.style.lineHeight = lineHeightInputs[0].value;
                    };
                }
                
                // å­—é—´è·å˜åŒ–
                if (lineHeightInputs.length > 1) {
                    lineHeightInputs[1].oninput = () => {
                        element.style.letterSpacing = lineHeightInputs[1].value + 'px';
                    };
                }
            }
        }

        // æ·»åŠ åˆ°Chat
        function addToChat(element) {
            let content = '';
            const elementType = element.getAttribute('data-type') || 'text';
            
            if (elementType === 'image') {
                // å›¾ç‰‡å…ƒç´ ï¼šæ·»åŠ å›¾ç‰‡å¼•ç”¨
                const imgSrc = element.src || element.getAttribute('data-content') || '';
                content = `[å›¾ç‰‡] ${imgSrc}`;
            } else {
                // æ–‡æœ¬å…ƒç´ ï¼šæ·»åŠ æ–‡æœ¬å†…å®¹
                content = element.getAttribute('data-content') || element.textContent.trim();
            }
            
            const workspaceInput = document.querySelector('#workspace .chat-input');
            
            if (workspaceInput) {
                // å¦‚æœè¾“å…¥æ¡†æœ‰å†…å®¹ï¼Œè¿½åŠ ï¼›å¦åˆ™ç›´æ¥å¡«å……
                const currentValue = workspaceInput.value.trim();
                if (currentValue) {
                    workspaceInput.value = currentValue + '\n\n[åœˆé€‰å†…å®¹] ' + content;
                } else {
                    workspaceInput.value = '[åœˆé€‰å†…å®¹] ' + content;
                }
                
                workspaceInput.focus();
                
                // æ»šåŠ¨åˆ°è¾“å…¥æ¡†
                workspaceInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // é«˜äº®è¾“å…¥æ¡†
                workspaceInput.style.borderColor = '#4a90e2';
                workspaceInput.style.boxShadow = '0 0 0 3px rgba(74, 144, 226, 0.2)';
                setTimeout(() => {
                    workspaceInput.style.borderColor = '';
                    workspaceInput.style.boxShadow = '';
                }, 2000);
            }

            // å–æ¶ˆé€‰æ‹©
            clearSelection();
        }

        // åˆ é™¤å…ƒç´ 
        function deleteElement(element) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå…ƒç´ å—ï¼Ÿ')) {
                element.remove();
                selectedElements.delete(element);
                
                // å¦‚æœè¿˜æœ‰å…¶ä»–é€‰ä¸­å…ƒç´ ï¼Œæ›´æ–°å·¥å…·æ 
                if (selectedElements.size > 0) {
                    updateSelectionToolbar();
                }
            }
        }

        // togglePropertyPanelå‡½æ•°å·²åœ¨headä¸­å®šä¹‰ï¼Œè¿™é‡Œä¸éœ€è¦é‡å¤å®šä¹‰

        // åˆå§‹åŒ–å±æ€§é¢æ¿çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            const propertyPanel = document.getElementById('propertyPanel');
            const expandBtn = document.getElementById('propertyPanelExpandBtn');
            
            if (propertyPanel) {
                // ä»localStorageè¯»å–çŠ¶æ€
                const savedState = localStorage.getItem('propertyPanelCollapsed');
                if (savedState === 'true') {
                    propertyPanel.classList.add('collapsed');
                    if (expandBtn) expandBtn.style.display = 'flex';
                } else {
                    if (expandBtn) expandBtn.style.display = 'none';
                }
            }
        });

            // ç›‘å¬ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
        document.addEventListener('DOMContentLoaded', function() {
            const modeButtons = document.querySelectorAll('#workspace .mode-btn');
            const workspace = document.getElementById('workspace');
            
            modeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    setTimeout(() => {
                        if (this.textContent.trim() === 'ç¼–è¾‘æ¨¡å¼') {
                            workspace.classList.add('edit-mode-active');
                            if (typeof window.initSelectionFeature === 'function') {
                                window.initSelectionFeature();
                            }
                        } else {
                            workspace.classList.remove('edit-mode-active');
                            if (typeof clearSelection === 'function') {
                                clearSelection();
                            }
                        }
                    }, 100);
                });
            });

            // åˆå§‹åŒ–åœˆé€‰åŠŸèƒ½ï¼ˆå¦‚æœé»˜è®¤æ˜¯ç¼–è¾‘æ¨¡å¼ï¼‰
            setTimeout(() => {
                const activeMode = document.querySelector('#workspace .mode-btn.active');
                if (activeMode && activeMode.textContent.trim() === 'ç¼–è¾‘æ¨¡å¼') {
                    workspace.classList.add('edit-mode-active');
                    if (typeof window.initSelectionFeature === 'function') {
                        window.initSelectionFeature();
                    }
                }
            }, 300);

            // æ”¯æŒå›è½¦é”®å‘é€ï¼ˆé¦–é¡µï¼‰
            const heroInput = document.getElementById('heroChatInput');
            if (heroInput) {
                heroInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        goToWorkspace();
                    }
                });
            }

            // æ”¯æŒå›è½¦é”®å‘é€ï¼ˆAIå·¥ä½œå°ï¼‰
            const workspaceInput = document.querySelector('#workspace .chat-input');
            if (workspaceInput) {
                workspaceInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        const message = this.value.trim();
                        if (message) {
                            sendWorkspaceMessage(message);
                        }
                    }
                });
            }

            // AIå·¥ä½œå°å‘é€æŒ‰é’®
            const workspaceSendBtn = document.querySelector('#workspace .send-btn');
            if (workspaceSendBtn) {
                workspaceSendBtn.addEventListener('click', function() {
                    const workspaceInput = document.querySelector('#workspace .chat-input');
                    if (workspaceInput) {
                        const message = workspaceInput.value.trim();
                        if (message) {
                            sendWorkspaceMessage(message);
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
